<!doctype html>






































<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en-us"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Sorting Testbench in C - Aniruddha Deb</title>

  
  <meta name="theme-color" />

  
  
  
  <meta name="description" content="I started reading CS theory in anticipation of my upcoming curriculum and I found that CLRS starts the reader off with sort algorithms (technically they start with math and basic CS, but I&rsquo;ve already covered that). I decided to make a Sorting testbench, whose requirements were pretty simple:
It should be able to generate arrays of a given entropy: the entropy of an array is defined as the number of swaps required to sort the array." />
  <meta name="author" content="Aniruddha Deb" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://aniruddhadeb.com/main.min.css" />

  

  
     
  <link rel="preload" as="image" href="https://aniruddhadeb.com/theme.svg" />

  
  
  
  <link rel="preload" as="image" href="/pic.png" />
  
  

  
  <link rel="preload" as="image" href="https://aniruddhadeb.com/twitter.svg" />
  
  <link rel="preload" as="image" href="https://aniruddhadeb.com/github.svg" />
  
  <link rel="preload" as="image" href="https://aniruddhadeb.com/rss.svg" />
  
  

  
  
  <link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.css"
  integrity="sha384-3UiQGuEI4TTMaFmGIZumfRPtfKQ3trwQE2JgosJxCnGmQpL/lJdjpcHkaaFwHlcI"
  crossorigin="anonymous"
/>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js"
  integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t"
  crossorigin="anonymous"
></script>
<script
  defer
  src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js"
  integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
  crossorigin="anonymous"
></script>

<script>
    document.addEventListener("DOMContentLoaded", () =>
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
          ],
          
          throwOnError : false
        })
    );
</script>

  
  
  

  
  <link rel="icon" href="https://aniruddhadeb.com/favicon/favicon.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://aniruddhadeb.com/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://aniruddhadeb.com/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://aniruddhadeb.com/favicon/favicon-16x16.png">
  <link rel="manifest" href="https://aniruddhadeb.com/favicon/site.webmanifest">

  
  <meta name="generator" content="Hugo 0.115.1">

  
  

  
  
  
  
  
  <meta itemprop="name" content="Sorting Testbench in C">
<meta itemprop="description" content="I started reading CS theory in anticipation of my upcoming curriculum and I found that CLRS starts the reader off with sort algorithms (technically they start with math and basic CS, but I&rsquo;ve already covered that). I decided to make a Sorting testbench, whose requirements were pretty simple:
It should be able to generate arrays of a given entropy: the entropy of an array is defined as the number of swaps required to sort the array."><meta itemprop="datePublished" content="2020-11-11T19:20:00+00:00" />
<meta itemprop="dateModified" content="2020-11-11T19:20:00+00:00" />
<meta itemprop="wordCount" content="2552">
<meta itemprop="keywords" content="Programming,C,Algorithms," />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Sorting Testbench in C"/>
<meta name="twitter:description" content="I started reading CS theory in anticipation of my upcoming curriculum and I found that CLRS starts the reader off with sort algorithms (technically they start with math and basic CS, but I&rsquo;ve already covered that). I decided to make a Sorting testbench, whose requirements were pretty simple:
It should be able to generate arrays of a given entropy: the entropy of an array is defined as the number of swaps required to sort the array."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-4xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="https://aniruddhadeb.com"
      >Aniruddha Deb</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/articles/"
        >Articles</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href="https://twitter.com/hairband_dude"
        target="_blank"
        rel="me"
      >
        twitter
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./github.svg)"
        href="https://github.com/Aniruddha-Deb"
        target="_blank"
        rel="me"
      >
        github
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./rss.svg)"
        href="https://aniruddhadeb.com/index.xml"
        target="_blank"
        rel="alternate"
      >
        rss
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-4xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Sorting Testbench in C</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Nov 11, 2020</time>
      
      
      
      
    </div>
    
  </header>

  <section><p>I started reading CS theory in anticipation of my upcoming curriculum and I found
that CLRS starts the reader off with sort algorithms (technically they start with
math and basic CS, but I&rsquo;ve already covered that). I decided to make a Sorting
testbench, whose requirements were pretty simple:</p>
<ul>
<li>It should be able to generate arrays of a given entropy: the entropy of an
array is defined as the number of swaps required to sort the array.</li>
<li>It should be able to benchmark the time taken by each sort</li>
<li>It should be able to plot the benchmark results in a single scatter plot,
using different colours for the different sorts.</li>
</ul>
<p>The first implementation of this was done using Java and JavaFX (ps: setting up
JavaFX with Java 15 is a pain in the ass, but more on that in a later blog).
The results were not too shabby, and I was able to accomplish a lot with
very little code. However, I was unhappy with the performance: I believed that
running the sorts on a JVM were not the way to go, and there were a lot of
outliers in the data, where I believed the JVM paused for it&rsquo;s GC cycle and that
got recorded by the benchmarker. This was the reason I decided to switch to
a language that was closer to the system, and that language was C.</p>
<p>Before that, here are some graphs from the Java version. This graph shows the
time taken in nanos (y axis) vs array size (x axis). The $O(n^2)$ characteristic is
clearly visible.</p>
<p><img src="/articles/2020/res/javasort_svt.png" alt="time taken vs array size"></p>
<p>Here&rsquo;s one more, showing the time taken vs array entropy, which is linear in
nature.</p>
<p><img src="/articles/2020/res/javasort_tve.png" alt="time taken vs array entropy"></p>
<h2 id="moving-to-c">Moving to C</h2>
<p>Moving to C was difficult. The things I had to implement manually were:</p>
<ol>
<li>ArrayList</li>
<li>PriorityQueue (via a Heap)</li>
<li>BitSet</li>
<li>Random int generator</li>
<li>Swap inserter</li>
<li>Circle drawing/filling algorithm</li>
<li>Dashed line drawing algorithm</li>
<li>Graph scale derivation algorithm</li>
<li>Sort algorithms</li>
</ol>
<h3 id="arraylist">ArrayList</h3>
<p>Implementing an ArrayList was quite easy. The only tricky parts were resizing the
ArrayList if the index overshot the current size.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">_ArrayList_expand</span>(ArrayList <span style="color:#f92672">*</span>list) {
</span></span><span style="display:flex;"><span>	list<span style="color:#f92672">-&gt;</span>capacity <span style="color:#f92672">*=</span> MULTIPLIER;
</span></span><span style="display:flex;"><span>	list<span style="color:#f92672">-&gt;</span>data <span style="color:#f92672">=</span> <span style="color:#a6e22e">realloc</span>(list<span style="color:#f92672">-&gt;</span>data, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">void</span><span style="color:#f92672">*</span>)<span style="color:#f92672">*</span>list<span style="color:#f92672">-&gt;</span>capacity);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">ArrayList_add</span>(ArrayList <span style="color:#f92672">*</span>list, <span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>elem) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (list<span style="color:#f92672">-&gt;</span>head <span style="color:#f92672">&gt;=</span> list<span style="color:#f92672">-&gt;</span>capacity) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_ArrayList_expand</span>(list);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (list<span style="color:#f92672">-&gt;</span>data <span style="color:#f92672">==</span> NULL) <span style="color:#66d9ef">return</span> ERR;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	list<span style="color:#f92672">-&gt;</span>data[list<span style="color:#f92672">-&gt;</span>head<span style="color:#f92672">++</span>] <span style="color:#f92672">=</span> elem;
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;Added element at %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, (<span style="color:#66d9ef">int</span>)list<span style="color:#f92672">-&gt;</span>head<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> OK;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="priorityqueue">PriorityQueue</h3>
<p>This was trickier. PriorityQueues are very well explained by <a href="https://algs4.cs.princeton.edu/24pq/">Algorithms, 4th ed</a>
with adequate code examples and all I did was implement them. The core concepts
are the same as that of a heap: data is stored in a binary tree represented as an
array, where the parent node of node $n$ is $\lfloor n/2 \rfloor$. This binary
heap has an $O(\log n)$ access and removal time. The elements are inserted in
any order and when they are removed, they are removed in sorted order. The link
does a better job of explaining it than I do, but here&rsquo;s how I implemented the
primary methods in C</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">IntPQ_insert</span>(IntPQ <span style="color:#f92672">*</span>ipq, <span style="color:#66d9ef">int</span> element) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (ipq<span style="color:#f92672">-&gt;</span>head<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;=</span> ipq<span style="color:#f92672">-&gt;</span>size) {
</span></span><span style="display:flex;"><span>		ipq<span style="color:#f92672">-&gt;</span>size <span style="color:#f92672">*=</span> MULTIPLIER;
</span></span><span style="display:flex;"><span>		ipq<span style="color:#f92672">-&gt;</span>arr <span style="color:#f92672">=</span> <span style="color:#a6e22e">realloc</span>(ipq<span style="color:#f92672">-&gt;</span>arr, <span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>)<span style="color:#f92672">*</span>ipq<span style="color:#f92672">-&gt;</span>size);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	ipq<span style="color:#f92672">-&gt;</span>arr[<span style="color:#f92672">++</span>ipq<span style="color:#f92672">-&gt;</span>head] <span style="color:#f92672">=</span> element;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (element <span style="color:#f92672">&gt;=</span> ipq<span style="color:#f92672">-&gt;</span>emap_lb <span style="color:#f92672">&amp;&amp;</span> element <span style="color:#f92672">&lt;=</span> ipq<span style="color:#f92672">-&gt;</span>emap_lb<span style="color:#f92672">+</span>ipq<span style="color:#f92672">-&gt;</span>emap_size<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">set_bit</span>(ipq<span style="color:#f92672">-&gt;</span>emap, element<span style="color:#f92672">-</span>ipq<span style="color:#f92672">-&gt;</span>emap_lb);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> ipq<span style="color:#f92672">-&gt;</span>head;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// swim element up
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">while</span> (k <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> ipq<span style="color:#f92672">-&gt;</span>arr[k<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>] <span style="color:#f92672">&gt;</span> ipq<span style="color:#f92672">-&gt;</span>arr[k]) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">swap</span>(<span style="color:#f92672">&amp;</span>ipq<span style="color:#f92672">-&gt;</span>arr[k<span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>], <span style="color:#f92672">&amp;</span>ipq<span style="color:#f92672">-&gt;</span>arr[k]);
</span></span><span style="display:flex;"><span>		k <span style="color:#f92672">/=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">IntPQ_remove</span>(IntPQ <span style="color:#f92672">*</span>ipq) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (ipq<span style="color:#f92672">-&gt;</span>head <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;Stack is empty</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> min <span style="color:#f92672">=</span> ipq<span style="color:#f92672">-&gt;</span>arr[<span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>	ipq<span style="color:#f92672">-&gt;</span>arr[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> ipq<span style="color:#f92672">-&gt;</span>arr[ipq<span style="color:#f92672">-&gt;</span>head<span style="color:#f92672">--</span>];
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// sink first element
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k <span style="color:#f92672">&lt;=</span> ipq<span style="color:#f92672">-&gt;</span>head) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (j <span style="color:#f92672">&lt;=</span> ipq<span style="color:#f92672">-&gt;</span>head<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> ipq<span style="color:#f92672">-&gt;</span>arr[j] <span style="color:#f92672">&gt;</span> ipq<span style="color:#f92672">-&gt;</span>arr[j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) j<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (ipq<span style="color:#f92672">-&gt;</span>arr[k] <span style="color:#f92672">&lt;</span> ipq<span style="color:#f92672">-&gt;</span>arr[j]) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">swap</span>(<span style="color:#f92672">&amp;</span>ipq<span style="color:#f92672">-&gt;</span>arr[k], <span style="color:#f92672">&amp;</span>ipq<span style="color:#f92672">-&gt;</span>arr[j]);
</span></span><span style="display:flex;"><span>		k <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> min;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="bitset">BitSet</h3>
<p>The <code>set_bit</code> function in the previous code sample must have raised some questions.
The PriorityQueue has a Bitset that facilitates $O(1)$ checking for elements in the array. Generally, a
HashTable would be better suited, but I didn&rsquo;t get around to implementing one
of those. A BitSet implementation is well described
<a href="https://stackoverflow.com/questions/4372515/how-to-implement-a-bitset-in-c">here</a>
and I did something similar here, so no worries there. It&rsquo;s not very memory efficient,
but it&rsquo;s good enough for the range of integers I generate.</p>
<h3 id="random-number-generator">Random Number Generator</h3>
<p>C comes with a built-in random number generator, implemented with the <code>rand()</code>
and <code>srand()</code> functions. However, the implementation of those functions varies
wildly from platform to platform, which I documented in
<a href="https://stackoverflow.com/questions/64619808/clang-poor-rand-implementation">this question</a>
and the algorithm is also well documented in <a href="https://medium.com/macoclock/are-random-number-on-mac-truly-random-c70e65630ce">this medium post</a>.
<code>rand()</code> on mac is taken from BSD, which says in it&rsquo;s own documentation that
it&rsquo;s a bad random number generator. The solution is to use <code>random()</code> and <code>srandom()</code>
on mac, which is comparatively better. The maximum value of the random number
generated using this method is $2^{31} - 1$. Using this, generating random
number within a given range is simple, and can be done using the following
snippet:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">gen_int</span>(<span style="color:#66d9ef">int</span> lb, <span style="color:#66d9ef">int</span> ub) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> (<span style="color:#66d9ef">int</span>)(((<span style="color:#66d9ef">double</span>)<span style="color:#a6e22e">random</span>())<span style="color:#f92672">/</span>RANDOM_MAX<span style="color:#f92672">*</span>(ub<span style="color:#f92672">-</span>lb) <span style="color:#f92672">+</span> lb);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Using this along with the PriorityQueue, we can generate an array of sorted
random numbers, into which swaps are then inserted.</p>
<h3 id="swap-inserter">Swap Inserter</h3>
<p>A swap or inversion is defined as a pair of integers at indices $i$ and $j$
such that $i &lt; j$ and $A[i] &gt; A[j]$, assuming the array is to be sorted in
ascending order. An array of length $n$ sorted in descending order has $\frac{n(n-1)}{2}$
inversions. If we have to insert $k$ inversions into a sorted array, take the
first $m$ integers such that $m(m-1)/2 &lt; k$. Reverse the order of these first
$m$ integers so that they&rsquo;re in descending order. We now have to insert
$k - m(m-1)/2$ swaps in the leftover array. To do this, take the last element
in the array (which is the largest) and move it back by $k - m(m-1)/2$ steps,
thereby inserting those many number of swaps.</p>
<h3 id="circle-drawing--filling-algorithm">Circle drawing &amp; filling algorithm</h3>
<p>Now that the integer generation side of things is done, we can move on to the
graphics side of things. I use SDL for all my graphics work with C and SDL
does not have a <code>SDL_RenderDrawCircle</code> or <code>SDL_RenderFillCircle</code> method. Since
circles are a must have primitive, I implemented my own circle drawing and
filling algorithm. This is based on the <a href="https://en.wikipedia.org/wiki/Midpoint_circle_algorithm">midpoint circle algorithm</a> and draws
(and fills) non-antialiased circles.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">render_circ_pts</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> x0, <span style="color:#66d9ef">int</span> y0, <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">+</span>x, y0<span style="color:#f92672">+</span>y);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">-</span>x, y0<span style="color:#f92672">+</span>y);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">+</span>x, y0<span style="color:#f92672">-</span>y);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">-</span>x, y0<span style="color:#f92672">-</span>y);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">+</span>y, y0<span style="color:#f92672">+</span>x);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">-</span>y, y0<span style="color:#f92672">+</span>x);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">+</span>y, y0<span style="color:#f92672">-</span>x);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x0<span style="color:#f92672">-</span>y, y0<span style="color:#f92672">-</span>x);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">render_circ_lines</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> x0, <span style="color:#66d9ef">int</span> y0, <span style="color:#66d9ef">int</span> x, <span style="color:#66d9ef">int</span> y, <span style="color:#66d9ef">bool</span> xch) {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// renders every point only once, so rendering with alpha &lt; 0xFF is not an issue. 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// also note the +1 for x2; SDL does not draw the last point in a line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">SDL_RenderDrawLine</span>(renderer, x0<span style="color:#f92672">-</span>x, y0<span style="color:#f92672">-</span>y, x0<span style="color:#f92672">+</span>x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y0<span style="color:#f92672">-</span>y);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (y <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SDL_RenderDrawLine</span>(renderer, x0<span style="color:#f92672">-</span>x, y0<span style="color:#f92672">+</span>y, x0<span style="color:#f92672">+</span>x<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y0<span style="color:#f92672">+</span>y);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (xch <span style="color:#f92672">&amp;&amp;</span> x <span style="color:#f92672">!=</span> y) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SDL_RenderDrawLine</span>(renderer, x0<span style="color:#f92672">-</span>y, y0<span style="color:#f92672">-</span>x, x0<span style="color:#f92672">+</span>y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y0<span style="color:#f92672">-</span>x);
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">SDL_RenderDrawLine</span>(renderer, x0<span style="color:#f92672">-</span>y, y0<span style="color:#f92672">+</span>x, x0<span style="color:#f92672">+</span>y<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, y0<span style="color:#f92672">+</span>x);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">render_circle</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> cx, <span style="color:#66d9ef">int</span> cy, <span style="color:#66d9ef">int</span> r, <span style="color:#66d9ef">bool</span> fill) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> r;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> dx <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>r;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> dy <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> re <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">bool</span> xch <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">while</span> (x <span style="color:#f92672">&gt;=</span> y) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (fill) <span style="color:#a6e22e">render_circ_lines</span>(renderer, cx, cy, x, y, xch);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> <span style="color:#a6e22e">render_circ_pts</span>(renderer, cx, cy, x, y);
</span></span><span style="display:flex;"><span>		xch <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>		y<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>		re <span style="color:#f92672">+=</span> dy;
</span></span><span style="display:flex;"><span>		dy <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>re <span style="color:#f92672">+</span> dx <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) {
</span></span><span style="display:flex;"><span>			xch <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>			x<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>			re <span style="color:#f92672">+=</span> dx;
</span></span><span style="display:flex;"><span>			dx <span style="color:#f92672">+=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SDL_RenderDrawCircle</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> cx, <span style="color:#66d9ef">int</span> cy, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">render_circle</span>(renderer, cx, cy, r, false);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SDL_RenderFillCircle</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> cx, <span style="color:#66d9ef">int</span> cy, <span style="color:#66d9ef">int</span> r) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">render_circle</span>(renderer, cx, cy, r, true);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is the entire algorithm, capable of drawing both filled and unfilled circles.
it&rsquo;s easy to draw filled circles as shown by the algorithm here as well as in
Wikipedia, but drawing filled circles is trickier, because you don&rsquo;t want to
go over a single point multiple times. This raises problems if your alpha is
less than 1. To counter this, you only draw lines when the x (or the y) changes
and if x is not equal to y. Here&rsquo;s what the result would look like if you went
over lines multiple times:</p>
<p><img src="/articles/2020/res/circle_fill_mult.png" alt="multiple rendering"></p>
<p>Here&rsquo;s what it looks like if you go over each pixel once</p>
<p><img src="/articles/2020/res/circle_fill_sing.png" alt="single rendering"></p>
<p>Much better!</p>
<h3 id="dashed-line-drawing-algorithm">Dashed Line Drawing Algorithm</h3>
<p>This is an implementation of the Bresenham algorithm for drawing lines. I needed
to draw only horizontal and vertical dashed lines to make the graph gridlines,
but I decided to make a full-fledged implementation of Bresenham&rsquo;s algorithm
to draw dashed lines. Again, this is an algorithm that SDL does not ship with; it
can only make solid lines and I had to implement this myself. Bresenham&rsquo;s
algorithm is decently simple and can be found in any graphics programming book.
The main concept behind the algorithm is making a choice between plotting
$(x+1, y+1)$ or $(x+1, y)$ for a line with a slope between 0 and 1. Mirroring /
flipping the algorithm gives you the line in the eight other octants.</p>
<p>This implementation for all 8 octants took quite a bit of head scratching as
most of the algorithms online used to work only in the first quadrant, or they
had different algorithms for other quadrants with repeated code, which was
messy. The key here is to realize that the increment can be either positive
or negative, but the error term will always be positive. The comments should
clarify this algorithm, as I wrote them to help me understand what&rsquo;s happening
where and when.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#75715e">// Bresenham line algorithm
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// similar to SDL_RenderDrawLine: draws x0, y0 and does not draw x1, y1 (x0 &lt;= L &lt; x1)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">SDL_RenderDrawDashedLine</span>(SDL_Renderer <span style="color:#f92672">*</span>renderer, <span style="color:#66d9ef">int</span> x0, <span style="color:#66d9ef">int</span> y0, <span style="color:#66d9ef">int</span> x1, <span style="color:#66d9ef">int</span> y1, <span style="color:#66d9ef">int</span> dashlen, <span style="color:#66d9ef">int</span> blanklen) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> Dx <span style="color:#f92672">=</span> x1 <span style="color:#f92672">-</span> x0;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> Dy <span style="color:#f92672">=</span> y1 <span style="color:#f92672">-</span> y0;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// dirx, diry - direction of line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// the direction being iterated over is 1 or -1, and the other one is 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> dirx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, diry <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// incx, incy - increment of line
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// the direction being iterated over is set to the same as dirx, while 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// the other one is 1, -1 or 0 depending on line direction.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> incx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, incy <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// first find the variable we will be iterating over - X or Y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">int</span> longest <span style="color:#f92672">=</span> <span style="color:#a6e22e">abs</span>(Dx);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> shortest <span style="color:#f92672">=</span> <span style="color:#a6e22e">abs</span>(Dy);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (longest <span style="color:#f92672">&lt;</span> shortest) {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// We&#39;ll iterate over y, so swap longest and shortest and then set dir* 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#75715e">// and inc* appropriately
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">swap</span>(<span style="color:#f92672">&amp;</span>longest, <span style="color:#f92672">&amp;</span>shortest);
</span></span><span style="display:flex;"><span>		dirx <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Dx <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) incx <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (Dx <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) incx <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Dy <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) diry <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">else</span> diry <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		incy <span style="color:#f92672">=</span> diry;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Iterating over x
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		diry <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Dy <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) incy <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (Dy <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>) incy <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (Dx <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">0</span>) dirx <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; <span style="color:#66d9ef">else</span> dirx <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		incx <span style="color:#f92672">=</span> dirx;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> err <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> x0;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> y <span style="color:#f92672">=</span> y0;
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// main drawing loop
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>longest; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (i<span style="color:#f92672">%</span>(dashlen<span style="color:#f92672">+</span>blanklen) <span style="color:#f92672">&lt;</span> dashlen)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">SDL_RenderDrawPoint</span>(renderer, x, y);
</span></span><span style="display:flex;"><span>		err <span style="color:#f92672">+=</span> shortest;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>(err<span style="color:#f92672">+</span>shortest) <span style="color:#f92672">&lt;</span> longest) {
</span></span><span style="display:flex;"><span>			x <span style="color:#f92672">+=</span> dirx;
</span></span><span style="display:flex;"><span>			y <span style="color:#f92672">+=</span> diry;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>			err <span style="color:#f92672">-=</span> longest;
</span></span><span style="display:flex;"><span>			x <span style="color:#f92672">+=</span> incx;
</span></span><span style="display:flex;"><span>			y <span style="color:#f92672">+=</span> incy;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This produces some pretty good results, and I can live with the distances not
exactly adhering to Pythagoras theorem, as highlighted by the rectangular rather
than radial boundaries for the dashes.</p>
<p><img src="/articles/2020/res/dotted_line.png" alt="dashed line"></p>
<h3 id="graph-scale-derivation-algorithm">Graph Scale Derivation Algorithm</h3>
<p>After making the primitive drawing algorithms, we can move on to drawing the
graph. Determining the scale of the graph is the only mathematical and challenging
part of drawing the graph, because the rest is mostly drudgework. I used
<a href="https://stackoverflow.com/questions/326679/choosing-an-attractive-linear-scale-for-a-graphs-y-axis">this StackOverFlow question</a>
as a base and developed my algorithm using that. The only difference is that
I floor the value while calculating lower bound rather than rounding it. The
following code should make the algorithm clear</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">round_tr</span>(<span style="color:#66d9ef">double</span> tr) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">int</span> nd <span style="color:#f92672">=</span> (<span style="color:#66d9ef">int</span>)(<span style="color:#a6e22e">log10</span>(tr))<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">double</span> exp <span style="color:#f92672">=</span> <span style="color:#a6e22e">pow</span>(<span style="color:#ae81ff">10</span>, nd);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">double</span> str <span style="color:#f92672">=</span> tr<span style="color:#f92672">/</span>exp;
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (str <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.1</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">0.1</span><span style="color:#f92672">*</span>exp);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (str <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.2</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">0.2</span><span style="color:#f92672">*</span>exp);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (str <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.25</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">0.25</span><span style="color:#f92672">*</span>exp);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (str <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.5</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">0.5</span><span style="color:#f92672">*</span>exp);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (str <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0.75</span>) <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">0.75</span><span style="color:#f92672">*</span>exp);
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">round</span>(exp);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span><span style="color:#75715e">// in the range determination function. Do similarily for y
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (xMin <span style="color:#f92672">!=</span> xMax) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">double</span> range <span style="color:#f92672">=</span> xMax <span style="color:#f92672">-</span> xMin;
</span></span><span style="display:flex;"><span>	gd<span style="color:#f92672">-&gt;</span>xtickrange <span style="color:#f92672">=</span> <span style="color:#a6e22e">round_tr</span>(range<span style="color:#f92672">/</span>numxticks);
</span></span><span style="display:flex;"><span>	gd<span style="color:#f92672">-&gt;</span>xlbound <span style="color:#f92672">=</span> gd<span style="color:#f92672">-&gt;</span>xtickrange<span style="color:#f92672">*</span><span style="color:#a6e22e">floor</span>(((<span style="color:#66d9ef">double</span>)xMin)<span style="color:#f92672">/</span>gd<span style="color:#f92672">-&gt;</span>xtickrange);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>.
</span></span></code></pre></div><h3 id="sort-algorithms">Sort Algorithms</h3>
<p>After the amount of stuff we have gone through, the sort algorithms now seem
trivial and easy. I just implemented some $O(n^2)$ algorithms to start off
with: Selection sort, bubble sort and insertion sort. I also created a <code>Sort</code>
structure containing a function pointer and a string, which I would use to
link the sort with a name. Here are the sorts I started off with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">selection_sort</span>(<span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>A) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> i;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j<span style="color:#f92672">=</span>i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>; j<span style="color:#f92672">&lt;</span>n; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (A[j] <span style="color:#f92672">&lt;</span> A[index]) index <span style="color:#f92672">=</span> j;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (index <span style="color:#f92672">!=</span> i)
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">swap</span>(<span style="color:#f92672">&amp;</span>A[index], <span style="color:#f92672">&amp;</span>A[i]);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">bubble_sort</span>(<span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>A) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; j<span style="color:#f92672">&lt;</span>n<span style="color:#f92672">-</span>i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>; j<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (A[j] <span style="color:#f92672">&gt;</span> A[j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]) {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">swap</span>(<span style="color:#f92672">&amp;</span>A[j], <span style="color:#f92672">&amp;</span>A[j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>]);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">insertion_sort</span>(<span style="color:#66d9ef">int</span> n, <span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>A) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>n; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> A[i];
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">while</span> (j<span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">&amp;&amp;</span> k <span style="color:#f92672">&lt;</span> A[j]) {
</span></span><span style="display:flex;"><span>			A[j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> A[j];
</span></span><span style="display:flex;"><span>			j<span style="color:#f92672">--</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		A[j<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> k;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here&rsquo;s the timing and plotting main function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>(<span style="color:#66d9ef">int</span> argc, <span style="color:#66d9ef">char</span> <span style="color:#f92672">**</span>argv) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">srandom</span>(<span style="color:#a6e22e">time</span>(NULL));
</span></span><span style="display:flex;"><span>	ArrayList <span style="color:#f92672">*</span>sortList <span style="color:#f92672">=</span> <span style="color:#a6e22e">new_ArrayList</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ArrayList_add</span>(sortList, <span style="color:#a6e22e">new_Sort</span>(<span style="color:#e6db74">&#34;Selection Sort&#34;</span>, <span style="color:#f92672">&amp;</span>selection_sort));
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ArrayList_add</span>(sortList, <span style="color:#a6e22e">new_Sort</span>(<span style="color:#e6db74">&#34;Insertion Sort&#34;</span>, <span style="color:#f92672">&amp;</span>insertion_sort));
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ArrayList_add</span>(sortList, <span style="color:#a6e22e">new_Sort</span>(<span style="color:#e6db74">&#34;Bubble Sort&#34;</span>, <span style="color:#f92672">&amp;</span>bubble_sort));
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">ArrayList_add</span>(sortList, <span style="color:#a6e22e">new_Sort</span>(<span style="color:#e6db74">&#34;Merge Sort&#34;</span>, <span style="color:#f92672">&amp;</span>merge_sort));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	ArrayList <span style="color:#f92672">*</span>dataList <span style="color:#f92672">=</span> <span style="color:#a6e22e">new_ArrayList</span>();
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>sortList<span style="color:#f92672">-&gt;</span>head; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		Sort <span style="color:#f92672">*</span>s <span style="color:#f92672">=</span> sortList<span style="color:#f92672">-&gt;</span>data[i];
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ArrayList_add</span>(dataList, <span style="color:#a6e22e">new_DataSet</span>(s<span style="color:#f92672">-&gt;</span>name));
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">bool</span> err <span style="color:#f92672">=</span> false;
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> c<span style="color:#f92672">=</span><span style="color:#ae81ff">50</span>; c<span style="color:#f92672">&lt;=</span><span style="color:#ae81ff">5000</span>; c<span style="color:#f92672">+=</span><span style="color:#ae81ff">50</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;Creating random array of size %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, c);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>ranarr <span style="color:#f92672">=</span> <span style="color:#a6e22e">gen_ints</span>(c, LBOUND, UBOUND, <span style="color:#ae81ff">0.8</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>sortList<span style="color:#f92672">-&gt;</span>head; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;allocating array of size %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, c);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">int</span> <span style="color:#f92672">*</span>arr <span style="color:#f92672">=</span> <span style="color:#a6e22e">malloc</span>(<span style="color:#66d9ef">sizeof</span>(<span style="color:#66d9ef">int</span>)<span style="color:#f92672">*</span>c);
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">memcpy</span>(arr, ranarr, c);
</span></span><span style="display:flex;"><span>			Sort <span style="color:#f92672">*</span>s <span style="color:#f92672">=</span> <span style="color:#a6e22e">ArrayList_get</span>(sortList, i);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">void</span> (<span style="color:#f92672">*</span>sort)(<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">int</span><span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> s<span style="color:#f92672">-&gt;</span>sort;
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">clock_t</span> begin <span style="color:#f92672">=</span> <span style="color:#a6e22e">clock</span>();
</span></span><span style="display:flex;"><span>			(<span style="color:#f92672">*</span>sort)(c, arr);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">clock_t</span> end <span style="color:#f92672">=</span> <span style="color:#a6e22e">clock</span>();
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">int</span> time_spent <span style="color:#f92672">=</span> <span style="color:#a6e22e">round</span>(<span style="color:#ae81ff">1000000.0</span><span style="color:#f92672">*</span>(end<span style="color:#f92672">-</span>begin)<span style="color:#f92672">/</span>CLOCKS_PER_SEC);
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is_sorted_asc</span>(c, arr)) {
</span></span><span style="display:flex;"><span>				err <span style="color:#f92672">=</span> true;
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;Sort %d failed</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">free</span>(arr);
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">log_debug</span>(<span style="color:#e6db74">&#34;Sort %d passed</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, i);
</span></span><span style="display:flex;"><span>				<span style="color:#a6e22e">DataSet_add</span>(dataList<span style="color:#f92672">-&gt;</span>data[i], <span style="color:#a6e22e">new_Point</span>(c, time_spent));
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">free</span>(arr);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">free</span>(ranarr);
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> (err) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>err) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">plotAll</span>(dataList<span style="color:#f92672">-&gt;</span>head, (DataSet<span style="color:#f92672">**</span>)dataList<span style="color:#f92672">-&gt;</span>data, <span style="color:#e6db74">&#34;Sorts - Time (us) vs Array Size&#34;</span>);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>; i<span style="color:#f92672">&lt;</span>sortList<span style="color:#f92672">-&gt;</span>head; i<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">destroy_Sort</span>(sortList<span style="color:#f92672">-&gt;</span>data[i]);
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">destroy_DataSet</span>(dataList<span style="color:#f92672">-&gt;</span>data[i]);
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">destroy_ArrayList</span>(sortList);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">destroy_ArrayList</span>(dataList);
</span></span><span style="display:flex;"><span>	
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This didn&rsquo;t work the first time and threw a segfault in my face :_( How typical
of C. I did debug it, and I&rsquo;m pretty pleased with the results.</p>
<p><img src="/articles/2020/res/plotter_example.png" alt="Plotter example"></p>
<h3 id="conclusion">Conclusion</h3>
<p>There are a lot of things that I have to improve here, some of which include</p>
<ol>
<li>Antialiasing circles and lines</li>
<li>More sorts - $O(n\log(n))$ and $O(n)$ sorts</li>
<li>Resizeable graphics</li>
<li>More customizable layouts</li>
<li>More flexible graphing - lines, histograms etc.</li>
</ol>
<p>I could have left the graphing to R or Python and just exported a CSV, but
where&rsquo;s the fun in that.</p>
<p>This project taught me more about graphics than it did about sorts and will continue to teach me more
as I keep working on it. For more updates, check out the repository <a href="https://github.com/Aniruddha-Deb/Algorithms">here</a>.</p>
</section>

  
  
  <footer class="mt-12 flex flex-wrap">
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aniruddhadeb.com/tags/programming"
      >Programming</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aniruddhadeb.com/tags/c"
      >C</a
    >
     
    <a
      class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]"
      href="https://aniruddhadeb.com/tags/algorithms"
      >Algorithms</a
    >
    
  </footer>
  

  
  

  
  
  <div class="mt-24" id="disqus_thread"></div>
  <script>
    const disqusShortname = 'aniruddha-deb';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
  

  
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2023
    <a class="link" href="https://aniruddhadeb.com">Aniruddha Deb</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
