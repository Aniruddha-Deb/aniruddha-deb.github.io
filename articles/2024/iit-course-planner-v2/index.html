<!DOCTYPE html>
<html class="not-ready lg:text-base" lang="en-us" style="--bg: #faf8f1">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<title>LLMs for parsing unstructured data (IIT Course Planner v2!) - Aniruddha Deb</title>
<meta name="theme-color"/>
<meta content="Happy new year! IIT Course planner (the course dependency graphs) used to be (and probably still is) the only reason people used to visit my blog. So much that it accounts for more views than any other webpage, except the homepage, and outdoes my next most popular article by 2x
The total pageviews is more than I expected :) It’s also no secret that I was working on a successor for the course planner for a while." name="description"/>
<meta content="Aniruddha Deb" name="author"/>
<link as="style" href="https://aniruddhadeb.com/main.min.css" rel="preload stylesheet"/>
<link as="image" href="https://aniruddhadeb.com/theme.svg" rel="preload"/>
<link as="image" href="/pic.png" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/twitter.svg" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/github.svg" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/rss.svg" rel="preload"/>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    processEscapes: true
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js" type="text/javascript">
</script>
<link href="https://aniruddhadeb.com/favicon/favicon.ico" rel="icon"/>
<link href="https://aniruddhadeb.com/favicon/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="https://aniruddhadeb.com/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="https://aniruddhadeb.com/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="https://aniruddhadeb.com/favicon/site.webmanifest" rel="manifest"/>
<meta content="Hugo 0.115.1" name="generator"/>
<meta content="LLMs for parsing unstructured data (IIT Course Planner v2!)" itemprop="name"/>
<meta content="Happy new year! IIT Course planner (the course dependency graphs) used to be (and probably still is) the only reason people used to visit my blog. So much that it accounts for more views than any other webpage, except the homepage, and outdoes my next most popular article by 2x
The total pageviews is more than I expected :) It’s also no secret that I was working on a successor for the course planner for a while." itemprop="description"/><meta content="2024-01-12T23:00:00+05:30" itemprop="datePublished"/>
<meta content="2024-01-12T23:00:00+05:30" itemprop="dateModified"/>
<meta content="1629" itemprop="wordCount"/>
<meta content="Programming,Data,Frontend,LLM," itemprop="keywords"/>
<meta content="summary" name="twitter:card"/>
<meta content="LLMs for parsing unstructured data (IIT Course Planner v2!)" name="twitter:title"/>
<meta content="Happy new year! IIT Course planner (the course dependency graphs) used to be (and probably still is) the only reason people used to visit my blog. So much that it accounts for more views than any other webpage, except the homepage, and outdoes my next most popular article by 2x
The total pageviews is more than I expected :) It’s also no secret that I was working on a successor for the course planner for a while." name="twitter:description"/>
</head>
<body class="text-black duration-200 ease-out dark:text-white">
<header class="mx-auto flex h-[4.5rem] max-w-4xl px-8 lg:justify-center">
<div class="relative z-50 mr-auto flex items-center">
<a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href="https://aniruddhadeb.com">Aniruddha Deb</a>
<div aria-label="Dark" class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]" role="button"></div>
</div>
<div aria-label="Menu" class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role="button"></div>
<script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>
<div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none">
<nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/articles/">Blog</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/publications/">Publications</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/files/cv.pdf">CV</a>
</nav>
<nav class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6">
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://twitter.com/hairband_dude" rel="me" style="--url: url(./twitter.svg)" target="_blank">
        twitter
      </a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://github.com/Aniruddha-Deb" rel="me" style="--url: url(./github.svg)" target="_blank">
        github
      </a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://aniruddhadeb.com/index.xml" rel="alternate" style="--url: url(./rss.svg)" target="_blank">
        rss
      </a>
</nav>
</div>
</header>
<main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-4xl px-8 pb-16 pt-12 dark:prose-invert">
<article>
<header class="mb-16">
<h1 class="!my-0 pb-2.5">LLMs for parsing unstructured data (IIT Course Planner v2!)</h1>
<div class="text-sm antialiased opacity-60">
<time>Jan 12, 2024</time>
</div>
</header>
<section><p>Happy new year! IIT Course planner (the course dependency graphs)
used to be (and probably still is) the only reason people used to visit my
blog. So much that it accounts for more views than any other webpage, except
the homepage, and outdoes my next most popular article by 2x</p>
<p>
<figure>
<img alt="That&amp;rsquo;s very few hits :(" src="/articles/2024/res/iitcp_hits.png"/>
<figcaption>The total pageviews is more than I expected :)</figcaption>
</figure>
</p>
<p>It’s also no secret that I was working on a successor for the course planner
for a while. The previous article had stowed the graphs right at the end, as
an appendix of sorts, and people had to scroll down all the time. So I’ll make
that easier this time.</p>
<p><strong>TL;DR:</strong> If you’re here for the successor, go <a href="https://aniruddhadeb.com/IIT_course_planner">here</a>.
<strong>It’s still a work in progress.</strong></p>
<h2 id="contributors">Contributors?</h2>
<p>There were 6 open things I wanted people to work on when it came to the initial
release, which can be seen on the
<a href="https://github.com/Aniruddha-Deb/IIT_course_planner/commit/eeb29e4bfd30c79ccb9cac11f35558d95cc59ad2">README</a>.
This was committed on Mar 2, 2022 and it has been almost two years since then.</p>
<p>In two years, I’ve got no contributors for these issues.</p>
<p>This is not a typo. I don’t know if I should be flattered, because I did it so
nicely in the first go or if I should be disappointed because everyone except
ES1 has access to these, and AM1/MS1 have pretty terrible diagrams because
their courses were newly introduced. I did get one text from one interested
person to add the ES1 dependencies, but that never materialized into anything.</p>
<p>Not having enough motivation to get the wheels rolling on v2, I tugged at my
ex-roommate<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" role="doc-noteref">1</a></sup> (who is now the overall coordinator of
<a href="https://devclub.in/#/">DevClub</a>), and asked him if he could get some
interested contributors.</p>
<h2 id="teamwork">Teamwork</h2>
<p>My seventh semester was hectic, to say the least. I was trying to push a
publication out while simultaneously applying to grad school, doing courses and
TAing a course (also why I didn’t blog much). While I do think I got a good
team, I barely got any time to scope out the project, do the scaffolding and
add boilerplate code so most of them could take the project forward. I think
only one guy came forward, forked my old repo and repurposed the <a href="https://aniruddhadeb.com/articles/2022/iit-course-planner-1/">pipeline</a> to
work on the 2023-24 courses of study. I didn’t pay much heed to this until my
semester was over, when I realized I should probably have a look. Cloning and
playing with the extraction code gave me some clean results. The recommmended
course extraction was not great, but I hacked something together in a few that
seemed to work. Unfortunately, this person was busy with a wedding and then
with other things, so Sisyphus was now carrying this rock alone up the hill.</p>
<p>Sisyphus, though, wanted to drop the rock and let it roll down the hill while
he enjoyed his last few months of being an undergraduate. Aditya didn’t like
that.</p>
<blockquote>
<p>“Kuch toh results dikha de”<br/>
“Yaar I can give it 20 hours. I think kuch toh nikal jayega but not promising anything”</p>
</blockquote>
<h2 id="data-pipeline">Data pipeline</h2>
<p>I had learnt a lot from last time, and that can roughly be summed up in 3 lines:</p>
<ol>
<li>No Jupyter Notebooks</li>
<li>No XML, use JSON</li>
<li>Manual labour where neccessary, LLMs where impossible</li>
</ol>
<p>So the first task was porting the pipeline from Jupyter to bash, and exporting
the details to JSON files. I drew up a small schema and got the data saved for
both courses and programmes to their respective JSON files.</p>
<p>The next step was extracting the recommended courses. I semi-automated this.
Table recognition has advanced a bit more since the last time I wrote the
script, and since our table had lines, <a href="https://betterprogramming.pub/extracting-tables-from-images-in-python-made-easy-ier-3be959555f6f">img2table</a>
made it easy. It wasn’t perfect, though. The results still had to be manually
verified. In hindsight, GPT-4V or LLaVa would be a good model to automate this
process. But that’s too much ML too early in the game, without good reason.</p>
<p>I had the course database and program data cleaned up in 5 hours, and the rest
to kill on building the UI. While I am a better frontend engineer now than I
was <a href="https://aniruddhadeb.com/articles/2022/rise-of-codefluencer/">last year</a>,
I didn’t want to do frontend yet.</p>
<p>Which finally brings us to the title :)</p>
<h2 id="llms-as-parsers-for-unstructured-data">LLMs as parsers for unstructured data</h2>
<p>To motivate the problem, consider a data extraction task. Suppose we need to
go from a table to a JSON:</p>
<pre tabindex="0"><code>                                                  "recommended": [
                                                    [
 +------+--------+--------+--------+--------+         "COL100",
 | Sem1 | COL100 | ELL101 | PYL101 | MTL100 |         "ELL101",
 +------+--------+--------+--------+--------+         "PYL101",
 | Sem2 | APL100 | CML101 | MCP100 | MTL101 |         "MTL100"
 +------+--------+--------+--------+--------+  -&gt;   ],
 | Sem3 | COL202 | COL215 | COL106 | MTL106 |       [
 +------+--------+--------+--------+--------+         "APL100",
 | Sem4 | COL216 | COL226 | COP290 | ELL205 |         ...
 +------+--------+--------+--------+--------+       ],
                                                    ...
                                                  ]
</code></pre><p>Because the input and output structure are well-defined, it’s easy to write a
program that traverses the table row by row and accumulates the courses. However,
if the input structure is not well-defined, or is mostly in natural language,
the task becomes a bit more interesting. Consider extracting course prerequisite
relations from text.</p>
<pre tabindex="0"><code>CLL251, MCL242, ESL760 -&gt; [CLL251 &amp;&amp; MCL242 &amp;&amp; ESL760]
AML701/AML734/CEL719/MEL733 -&gt; [AML701 || AML734 || CEL719 || MEL733]
</code></pre><p>If every course relation was defined so cleanly, this would also be a structured
data extraction problem. The issue is that in the wild, prerequisites look
something like this</p>
<pre tabindex="0"><code>APL104 or equivalent, APL106 or equivalent
Basic Mathematics (Class 10 level)
APL104/APL105/APL108 EC 50
TXL111/TXL221 for uG students
ELL101 and ELL202 and (ELL211 or ELL231)
To be declared by Instructor
</code></pre><p>If you had a lot of people, you’d harvest these manually. If you had a small
team of developers, you’d accumulate a bunch of heuristics and rules to parse.
Since I’m a single developer, using an LLM and calling it a day seems best</p>
<h3 id="prior-work">Prior work</h3>
<p>Surprisingly, I couldn’t find many papers which propose this task. This is
probably an Information Extraction task, with a specific schema. Generalizing
IE from task-specific models such as tagging/semantic parsing/relation extraction
to models capable of handling generalized schemas seems to be a task called
Universal Information Extraction [<a href="https://arxiv.org/pdf/2312.17617.pdf">1</a>],
and there are some techniques for this [<a href="https://arxiv.org/pdf/2304.08085.pdf">2</a>].</p>
<p>In my opinion, this is a good research direction. Semi-automated, or fully
automated extraction of data from unstructured sets, with:</p>
<ol>
<li>Either a focus on <strong>varying schemas</strong>, where the ability of models are not
their accuracy on the task, but how accurately they are capable of adapting
and generalizing to new schemas and structures, or</li>
<li>A focus on <strong>LLMs generating the best schemas for the data on their own</strong>.</li>
</ol>
<p>Considering the advances with LLMs, and considering how much unstructured data
there is, this is somewhat similar to LLMs cleaning up data to train themselves,
but in a more general context.</p>
<p>But enough playing Paul Graham. Let’s build something!</p>
<h3 id="not-your-weights-not-your-brain">Not your Weights, Not your Brain</h3>
<p>I initially tried using the perplexity API, but they kept declining my card.
I then spent an hour and a half setting up Mistral-7B on my MBP. This is a good
time to shout out to <a href="https://github.com/ml-explore/mlx">MLX</a>, which is fast
becoming the de-facto framework for ML on Apple Silicon. Just like everything
Apple does: Metal instead of better OpenGL/Vulkan, Swift/Objective-C instead of
C++, and MLX instead of PyTorch. Atleast MLX shipped with some very nice
<a href="https://github.com/ml-explore/mlx-examples/">examples</a>, which basically tell
you how to quantize and run your mistral quickly on Mac. This was easy to set
up, and fine-grained control over the prompt allowed me to cache the in-context
examples beforehand, making inference fairly quick.</p>
<p>If you don’t have an apple silicon or NVIDIA GPU for inference, I later signed
up for Together’s API, which also gives you $25 in free credits! That’s a good
alternative.</p>
<p>With a model set up, we can now move to the prompt and task itself</p>
<h3 id="parsing-at-last">Parsing at last</h3>
<p>This was fairly simple if you know a bit of prompt engineering. You don’t even
need to take care of the Mistral Instruction tokens (<code>[INST]</code> and <code>[/INST]</code>),
as I got better results without them. For completeness, here was the prompt:</p>
<pre tabindex="0"><code>You need to parse a set of course prerequisites into logical expressions which can be parsed by a machine. The input format is in plaintext, and the output is a boolean expression within square brackets. If there is any confusion, choose the most unambiguous combination. Ignore "Or Equivalent", "Undergraduate" or any other qualifiers. ONLY include alphanumeric course codes, or EC values. EXACTLY FOLLOW THE FORMAT.

Prerequisites: APL104/APL105/APL108 EC50
Parsed: [(APL104 || APL105 || APL108) &amp;&amp; EC50]

Prerequisites: APL106 or equivalent, APL321
Parsed: [APL106 &amp;&amp; APL321]

Prerequisites: BBL131, BBL331 or Masters’ degree in
Parsed: [BBL131 &amp;&amp; BBL331]

Prerequisites: CVL242 or Concurrent with CVL242
Parsed: [CVL242 || CVL242c]

Prerequisites: CVL281 and CVL282
Parsed: [CVL281 &amp;&amp; CVL282]

Prerequisites: CVL282 or EC 75
Parsed: [CVL282 || EC75]

Prerequisites: To be declared by Instructor
Parsed: []

Prerequisites: CLL222, CLL352
Parsed: [CLL252 &amp;&amp; CLL352]

Prerequisites: M.Tech: Nil; B.Tech: Instructor's permission
Parsed: []

Prerequisites: MCL140, APL106 or APL105, ESL200, ESL262,
Parsed: [MCL140 &amp;&amp; (APL106 || APL105) &amp;&amp; ESL200 &amp;&amp; ESL262]

Prerequisites: (example here)
Parsed:
</code></pre><p>Note the extra concurrent example. Only the Civil Engineering department has
this. Picking the examples required me to skim over the dataset and look for
abnormalities. We don’t really care about similarity between the in-context
and parsed examples, as we’re not doing an eval here.</p>
<p>This gave quite decent results, and took a bit under 1.5 hours to run on my
machine for &gt;5000 courses. With this done, the boring part was left.</p>
<h2 id="frontend">Frontend</h2>
<p>Kick starting any project with ChatGPT is a godsend, and should become standard
practice at this point. The first version just loaded the JSON courses and
displayed them on a table.</p>
<p>
<img alt="" src=""/>
</p>
<p>The next version was a bit better.</p>
<div class="footnotes" role="doc-endnotes">
<hr/>
<ol>
<li id="fn:1">
<p>Final year, single rooms. Although his room is still next to mine ^_^ <a class="footnote-backref" href="#fnref:1" role="doc-backlink">↩︎</a></p>
</li>
</ol>
</div>
</section>
<footer class="mt-12 flex flex-wrap">
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/programming">Programming</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/data">Data</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/frontend">Frontend</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/llm">LLM</a>
</footer>
<nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
<a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href="https://aniruddhadeb.com/articles/2023/japan-sakura/"><span>Lost in Japan: A Travelogue (Part 1)</span><span class="ml-1.5">→</span></a>
</nav>
<div class="mt-24" id="disqus_thread"></div>
<script>
    const disqusShortname = 'aniruddha-deb';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
</article>
</main>
<footer class="opaco mx-auto flex h-[4.5rem] max-w-4xl items-center px-8 text-[0.9em] opacity-60">
<div class="mr-auto">
    © 2024
    <a class="link" href="https://aniruddhadeb.com">Aniruddha Deb</a>
</div>
<a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Built with Hugo️️</a>️
  <a class="link" href="https://github.com/Aniruddha-Deb/hugo-paper" rel="noopener" target="_blank">✎ Paper</a>
</footer>
</body>
</html>
