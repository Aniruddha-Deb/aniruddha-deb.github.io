
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://aniruddhadeb.com/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://aniruddhadeb.com/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css">


    <link href="https://aniruddhadeb.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Aniruddha Deb Atom">

    <link href="https://aniruddhadeb.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Aniruddha Deb RSS">


<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79245932-2', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']]
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js' type='text/javascript'></script>  

<meta name="author" content="Aniruddha Deb" />
<meta name="description" content="Remember last semester, where I said this? That went pretty well. Much better than I expected it to go :) I also used the HPC DL environment a lot, across 4 courses that I did (COL380, COL772, COL775 and COD310). It was so used that at a point I had four …" />
<meta name="keywords" content="Programming, Machine Learning, Deep Learning">

<meta property="og:site_name" content="Aniruddha Deb"/>
<meta property="og:title" content="My (updated) DL workflow for 2023"/>
<meta property="og:description" content="Remember last semester, where I said this? That went pretty well. Much better than I expected it to go :) I also used the HPC DL environment a lot, across 4 courses that I did (COL380, COL772, COL775 and COD310). It was so used that at a point I had four …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="https://aniruddhadeb.com/articles/2023/updated-dl-workflow-2023.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2023-06-04 01:00:00+05:30"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://aniruddhadeb.com/author/aniruddha-deb.html">
<meta property="article:section" content="Programming"/>
<meta property="article:tag" content="Programming"/>
<meta property="article:tag" content="Machine Learning"/>
<meta property="article:tag" content="Deep Learning"/>
<meta property="og:image" content="/extras/sitelogo.png">

  <title>Aniruddha Deb &ndash; My (updated) DL workflow for 2023</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://aniruddhadeb.com">
        <img src="/extras/sitelogo.png" alt="" title="">
      </a>
      <h1><a href="https://aniruddhadeb.com"></a></h1>


      <nav>
        <ul class="list">
          <li><a href="https://aniruddhadeb.com/pages/about.html#about">About</a></li>
          <li><a href="https://aniruddhadeb.com/pages/feeds.html#feeds">Feeds</a></li>

          <li><a href="/archives.html">archives</a></li>
          <li><a href="/categories">categories</a></li>
          <li><a href="/tags">tags</a></li>
          <li><a href="https://www.cse.iitd.ac.in/~cs1200869">website</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-github" href="https://www.github.com/Aniruddha-Deb" target="_blank"><i class="fab fa-github"></i></a></li>
        <li><a class="sc-stack-exchange" href="https://stackexchange.com/users/12827944/aniruddha-deb" target="_blank"><i class="fab fa-stack-exchange"></i></a></li>
        <li><a class="sc-goodreads-g" href="https://www.goodreads.com/aniruddhadeb" target="_blank"><i class="fab fa-goodreads-g"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:aniruddha.deb.2002@gmail.com" target="_blank"><i class="fas fa-envelope"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="updated-dl-workflow-2023">My (updated) DL workflow for 2023</h1>
    <p>
          Posted on Sun 04 June 2023 in <a href="https://aniruddhadeb.com/category/programming.html">Programming</a>


    </p>
  </header>


  <div>
    <p>Remember last semester, where I said this?</p>
<p><center>
<img width="600px" src="/articles/2022/res/cs_degree.png">
</center></p>
<p>That went pretty well. Much better than I expected it to go :) I also used the 
HPC DL environment a lot, across 4 courses that I did (COL380, COL772, COL775 
and COD310). It was so used that at a point I had four different GPU's allocated
just for running tasks for these different courses.</p>
<p>A lot could be done better, though. Since I have my summer ahead of me, I
decided to clean house for the next semester</p>
<h2>The secret life of software</h2>
<p>After an OS course that delved deep into the linux kernel, I'm qualified to 
talk about this. For software-specific stuff, the relevant linux directories
are structured as follows:</p>
<div class="highlight"><pre><span></span><code>/ <span class="c1"># Root - primary hierarchy</span>
<span class="sb">`</span>- bin <span class="c1"># where your executables go</span>
<span class="sb">`</span>- include <span class="c1"># where header files go</span>
<span class="sb">`</span>- lib <span class="c1"># where libraries go</span>
<span class="sb">`</span>- home <span class="c1"># home directories of users</span>
<span class="p">|</span>  <span class="sb">`</span>- aniruddha <span class="c1"># home directories of users</span>
<span class="p">|</span>     <span class="sb">`</span>- .local <span class="c1"># User-specific tertiary hierarchy</span>
<span class="p">|</span>     <span class="p">|</span>  <span class="sb">`</span>- bin
<span class="p">|</span>     <span class="p">|</span>  <span class="sb">`</span>- include
<span class="p">|</span>     <span class="p">|</span>  <span class="sb">`</span>- lib
<span class="p">|</span>     <span class="sb">`</span>- .conda
<span class="p">|</span>     <span class="p">|</span>  <span class="sb">`</span>- envs
<span class="p">|</span>     <span class="p">|</span>     <span class="sb">`</span>- dl <span class="c1"># a single environment folder</span>
<span class="p">|</span>     <span class="p">|</span>        <span class="sb">`</span>- bin
<span class="p">|</span>     <span class="p">|</span>        <span class="sb">`</span>- include
<span class="p">|</span>     <span class="p">|</span>        <span class="sb">`</span>- lib
<span class="p">|</span>     <span class="sb">`</span>- .config <span class="c1"># directory containing config files</span>
<span class="p">|</span>     <span class="sb">`</span>- .bashrc <span class="c1"># sourced on every login shell</span>
<span class="p">|</span>     <span class="sb">`</span>- scratch -&gt; /scratch/aniruddha <span class="c1"># HPC specific scratch directory</span>
<span class="p">|</span>
<span class="sb">`</span>- usr <span class="c1"># Unix System Resources - Secondary Hierarchy, read only stuff for users</span>
<span class="p">|</span>  <span class="sb">`</span>- bin
<span class="p">|</span>  <span class="sb">`</span>- include
<span class="p">|</span>  <span class="sb">`</span>- lib
<span class="p">|</span>  <span class="sb">`</span>- <span class="nb">local</span> <span class="c1"># Tertiary hierarchy - has it&#39;s own bin, include, lib, etc</span>
<span class="p">|</span>  <span class="sb">`</span>- share <span class="c1"># Architecture Independent (shared) data</span>
<span class="sb">`</span>- opt <span class="c1"># Optional software</span>
</code></pre></div>

<p>The <code>PATH</code> variable's contents now make a lot more sense. An <code>echo $PATH</code> on a
unix box will usually have all the <code>bin</code> directories shown above, and doing a
<code>echo $LD_LIBRARY_PATH</code> will have all the <code>lib</code> directories above. It's simple,
intuitive and has been working for half a century now. More details can be found
<a href="https://refspecs.linuxfoundation.org/FHS_3.0/fhs/index.html">here</a>.</p>
<p>Let's say that we don't have super-user privileges. This brings two challenges:
- <strong>The only directory above that we can write to is our home directory</strong>.
  That's it. Any software/libraries/headers that we need to install need to be
  installed in <code>.local</code> and added to path/symlinked through
- If a binary already exists in <code>/bin</code> or <code>/usr/bin</code>, that would be registered
  by the system, especially if it needed an older version. This is visible
  in HPC, which has super-old versions of <code>git</code> (1.8x) and <code>conda</code> (5.x).</p>
<p>Even when it comes to modules, HPC doesn't have the latest <code>gcc</code> (stuck at 9)
or modern build tools, such as <code>cmake</code> or <code>ninja</code>. There is no clean way to 
even install these. The <a href="https://supercomputing.iitd.ac.in/?soft">HPC website</a> 
mentions two options that you can take in this event:</p>
<ol>
<li>Install the software in your own account (<code>$HOME</code>)</li>
<li>Request installation, via your supervisor.</li>
</ol>
<p>2 would be a good option if it didn't have a turnaround time of over a month,
so the only sane thing to do is 1.</p>
<h2>Install software locally</h2>
<p>This is easier than it sounds. HPC runs CentOS 7, which uses <code>yum</code> as it's 
package manager, so installing software should be as easy as doing <code>yum install 
&lt;packagename&gt; --local</code>, right?</p>
<p>Nope.</p>
<p>yum doesn't support doing this natively. <a href="https://stackoverflow.com/questions/36651091/how-to-install-packages-in-linux-centos-without-root-user-with-automatic-depen">After some research</a>, 
you can get yum to install things locally, but it's not worth the effort. <code>dnf</code>
isn't installed, neither is any other package manager, so this turns up a dead
end.</p>
<blockquote>
<h4>Aside: Package Managers</h4>
<p>What I had been doing so far was to build software from source if needed, and
then pass the installation directory using a flag in the <code>make install</code> step.
This is <em>(a)</em> super hard and <em>(b)</em> unsustainable. (a) because you'd need to 
take into account all of the package's dependencies, and (b) because you'd 
need to update the package if a newer version came around. </p>
<p>Package managers take away all of this pain by handling the dependency 
management and updates on their own. So what we're really looking for is <strong>a 
package manager that manages it's repository of packages in .local and, ipso 
facto, can be run without superuser privileges.</strong></p>
</blockquote>
<h2>(Mini)Conda to the rescue</h2>
<p>The second answer in the StackExchange thread linked above recommended using
<code>conda</code> as a package manager, and that's what was finally done. However, the 
<code>conda</code> version as mentioned above is outdated, and since we want to use the
most up to date versions of packages, that would defeat the purpose.</p>
<p>To fix this, I installed miniconda locally in <code>$HOME/.local/opt/miniconda3</code>, 
following the good directory structure above. <code>miniconda3</code> is an open-source 
conda variant and picks up right where <code>conda</code> left off: it has access to all 
my old environments, and also uses the preferences in my <code>.condarc</code> to make
new environments in <code>scratch/conda_data/envs</code>, so that others can also use 
them.</p>
<p>What about keeping miniconda up to date? <em>Miniconda updates itself, so we don't 
need to do anything!</em> conda also launches the <code>base</code> environment by default, so 
all we need to do is prepend the base conda environment's <code>bin</code> to our <code>PATH</code>,
and we can use <code>conda</code> to manage our executables!</p>
<h2>What now?</h2>
<p>Let's update git, gcc, g++ and get cmake and node</p>
<div class="highlight"><pre><span></span><code>conda install -c conda-forge git gcc gxx cmake <span class="nv">nodejs</span><span class="o">==</span><span class="m">18</span>.5.0
</code></pre></div>

<p>Let's also install neovim. Unfortunately there isn't a conda package for this
(there was one, but that was for neovim python bindings), so I had to manually
download the appimage from <a href="https://github.com/neovim/neovim/releases/download/stable/nvim-linux64.tar.gz">here</a> 
and move the files to the right locations. Once that was done, I installed packer
to the right place, and copied my config over. Everything worked as expected 
after that.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://twitter.com/Neovim?ref_src=twsrc%5Etfw">@neovim</a> is goated. <a href="https://twitter.com/code?ref_src=twsrc%5Etfw">@code</a> is bloated.</p>&mdash; Aniruddha Deb (@hairband_dude) <a href="https://twitter.com/hairband_dude/status/1665143467079507968?ref_src=twsrc%5Etfw">June 3, 2023</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>After that, I made an environment for PyTorch 2. It's a bit too late now to
test out <code>torch.compile</code>, but I will tomorrow on a couple of models. I also 
wanted to develop <a href="https://github.com/Aniruddha-Deb/pajamas">pajamas</a> further,
which I'll probably do sooner or later.</p>
<p>And with that, I'm ready to become a researcher for the next two semesters :)</p>
<h2>Other things</h2>
<p><a href="https://aniruddhadeb.com/articles/2022/intern-inferno.html#intern-inferno">Amsterdam is Beautiful</a></p>
<p><img alt="random bridge sunset" src="res/amsterdam.jpg"></p>
<p>So is Rotterdam</p>
<p><img alt="erasmus bridge" src="res/rotterdam.jpg"></p>
<p>So is Antwerp</p>
<p><img alt="grote markt" src="res/antwerp.jpg"></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://aniruddhadeb.com/tag/programming.html">Programming</a>
      <a href="https://aniruddhadeb.com/tag/machine-learning.html">Machine Learning</a>
      <a href="https://aniruddhadeb.com/tag/deep-learning.html">Deep Learning</a>
    </p>
  </div>





<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'aniruddha-deb';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
        Please enable JavaScript to view comments.

</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Aniruddha Deb ",
  "url" : "https://aniruddhadeb.com",
  "image": "/extras/sitelogo.png",
  "description": ""
}
</script>

</body>
</html>