<!DOCTYPE html>
<html class="not-ready lg:text-base" lang="en-us" style="--bg: #faf8f1">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<title>C development on a Mac - Aniruddha Deb</title>
<meta name="theme-color"/>
<meta content="C development on a Mac has it’s fair share of traps and pitfalls, even though Mac is supposed to be POSIX compliant. I’ll cover a few of them here, with the hope that nobody repeats the same mistakes :)
XCode CLT Pitfalls The first thing one does while starting out with C development is to install a compiler. This is slightly more complicated than it looks on Mac: the simple way is to go the way of installing XCode command line tools, but there’s a few things here to note:" name="description"/>
<meta content="Aniruddha Deb" name="author"/>
<link as="style" href="https://aniruddhadeb.com/main.min.css" rel="preload stylesheet"/>
<link as="image" href="https://aniruddhadeb.com/theme.svg" rel="preload"/>
<link as="image" href="/pic.png" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/twitter.svg" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/github.svg" rel="preload"/>
<link as="image" href="https://aniruddhadeb.com/rss.svg" rel="preload"/>
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    processEscapes: true
  },
  svg: {
    fontCache: 'global'
  }
};
</script>
<script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js" type="text/javascript">
</script>
<link href="https://aniruddhadeb.com/favicon/favicon.ico" rel="icon"/>
<link href="https://aniruddhadeb.com/favicon/apple-touch-icon.png" rel="apple-touch-icon" sizes="180x180"/>
<link href="https://aniruddhadeb.com/favicon/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<link href="https://aniruddhadeb.com/favicon/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="https://aniruddhadeb.com/favicon/site.webmanifest" rel="manifest"/>
<meta content="Hugo 0.115.1" name="generator"/>
<meta content="C development on a Mac" itemprop="name"/>
<meta content="C development on a Mac has it’s fair share of traps and pitfalls, even though Mac is supposed to be POSIX compliant. I’ll cover a few of them here, with the hope that nobody repeats the same mistakes :)
XCode CLT Pitfalls The first thing one does while starting out with C development is to install a compiler. This is slightly more complicated than it looks on Mac: the simple way is to go the way of installing XCode command line tools, but there’s a few things here to note:" itemprop="description"/><meta content="2021-03-18T11:46:00+00:00" itemprop="datePublished"/>
<meta content="2021-03-18T11:46:00+00:00" itemprop="dateModified"/>
<meta content="787" itemprop="wordCount"/>
<meta content="Programming,C," itemprop="keywords"/>
<meta content="summary" name="twitter:card"/>
<meta content="C development on a Mac" name="twitter:title"/>
<meta content="C development on a Mac has it’s fair share of traps and pitfalls, even though Mac is supposed to be POSIX compliant. I’ll cover a few of them here, with the hope that nobody repeats the same mistakes :)
XCode CLT Pitfalls The first thing one does while starting out with C development is to install a compiler. This is slightly more complicated than it looks on Mac: the simple way is to go the way of installing XCode command line tools, but there’s a few things here to note:" name="twitter:description"/>
</head>
<body class="text-black duration-200 ease-out dark:text-white">
<header class="mx-auto flex h-[4.5rem] max-w-4xl px-8 lg:justify-center">
<div class="relative z-50 mr-auto flex items-center">
<a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href="https://aniruddhadeb.com">Aniruddha Deb</a>
<div aria-label="Dark" class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]" role="button"></div>
</div>
<div aria-label="Menu" class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role="button"></div>
<script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>
<div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none">
<nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/articles/">Blog</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/publications/">Publications</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href="/files/cv.pdf">CV</a>
</nav>
<nav class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6">
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://twitter.com/hairband_dude" rel="me" style="--url: url(./twitter.svg)" target="_blank">
        twitter
      </a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://github.com/Aniruddha-Deb" rel="me" style="--url: url(./github.svg)" target="_blank">
        github
      </a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" href="https://aniruddhadeb.com/index.xml" rel="alternate" style="--url: url(./rss.svg)" target="_blank">
        rss
      </a>
</nav>
</div>
</header>
<main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-4xl px-8 pb-16 pt-12 dark:prose-invert">
<article>
<header class="mb-16">
<h1 class="!my-0 pb-2.5">C development on a Mac</h1>
<div class="text-sm antialiased opacity-60">
<time>Mar 18, 2021</time>
</div>
</header>
<section><p>C development on a Mac has it’s fair share of traps and pitfalls, even though
Mac is supposed to be POSIX compliant. I’ll cover a few of them here, with the
hope that nobody repeats the same mistakes :)</p>
<h2 id="xcode-clt-pitfalls">XCode CLT Pitfalls</h2>
<p>The first thing one does while starting out with C development is to install
a compiler. This is slightly more complicated than it looks on Mac: the simple
way is to go the way of installing XCode command line tools, but there’s a few
things here to note:</p>
<h3 id="you-have-to-be-an-apple-developer">You have to be an apple developer</h3>
<p>This means that you can’t have a C/C++ toolchain without being a part of
of their developer program. There is a (messy) way of working around this, by instead
installing and using GCC with HomeBrew, but I’ll get to that in a minute.</p>
<h3 id="xcode-clt-uses-the-clang-toolchain">XCode CLT uses the <code>clang</code> toolchain</h3>
<p>This is by far the most important pitfall, as XCode purposefully misaliases
a lot of stuff. After installing XCode CLT (and provided that you don’t have
GCC installed or aliased), try doing a <code>gcc -v</code> or <code>g++ -v</code>. You’d get</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;" tabindex="0"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Configured with: --prefix=/Library/Developer/CommandLineTools/usr --with-gxx-include-dir=/usr/include/c++/4.2.1
</span></span><span style="display:flex;"><span>Apple clang version 12.0.0 (clang-1200.0.32.27)
</span></span><span style="display:flex;"><span>Target: x86_64-apple-darwin19.6.0
</span></span><span style="display:flex;"><span>Thread model: posix
</span></span><span style="display:flex;"><span>InstalledDir: /Library/Developer/CommandLineTools/usr/bin
</span></span></code></pre></div><p>This is quite misleading, as <code>gcc</code> and <code>clang</code> are fundamentally different
compilers. <a href="https://stackoverflow.com/questions/25745759/clang-vs-gcc-vs-msvc-template-conversion-operator-which-compiler-is-right/25758367#25758367">Here’s one example of that</a>.
A more accessible example would be this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;" tabindex="0"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#66d9ef">int</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> x<span style="color:#f92672">/++</span>x;
</span></span></code></pre></div><p>try compiling this with <code>gcc</code> and <code>clang</code>, and be surprised*.</p>
<h3 id="headers-what-headers">Headers? What Headers?</h3>
<p>Headers are also <em>very weirdly located</em> in <code>/Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/usr/include</code>,
and these headers are also <strong>not</strong> symlinked to <code>/usr/include</code> by the installer.
This sucks, and I struggled with making vim autocomplete work because of this
reason; vim’s path searches <code>/usr/include</code> and not this weird obscure path.
Once I manually included it, it <strike>looked horrible and I needed to symlink it
to /usr/include</strike> worked okayish.</p>
<p><img alt="image" src="/articles/2021/res/vim_autocomp.png"/></p>
<p>One note is that you could also use the path <code>/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk/usr/include</code>,
as <code>MacOSX.sdk</code> is linked to the latest version of SDK installed. This does not
make the location of includes any less weird.</p>
<p>Another thing to note is that other libraries install their headers in <code>/usr/local/include</code>,
so this discrepancy is bad. This has also not been fixed in Big Sur: how hard
is it to keep a set of headers in <code>/usr/include</code> rather than in this unsightly
place! I mean every UNIX system does this! Ugh</p>
<h3 id="ctags">CTags</h3>
<p>CLT also ships with the old ctags rather than exuberant ctags, which is basically
useless. Neither is there a simple way to distinguish between the ctags that
it ships and exuberant ctags until it fails hard when you go to make your tags
file, since they have the same <code>ctags</code> command. The way of fixing this is to
install the proper ctags with <code>brew install ctags</code> and then add
<code>alias ctags=/usr/local/include/ctags</code> to your <code>.zshrc</code>.</p>
<h2 id="using-gcc">Using GCC</h2>
<p>So you decide that the <code>clang</code> toolchain is not working out for you (maybe because
it’s slow or for other reasons), and you decide to switch to the <code>gcc</code> toolchain
(by Toolchain, I refer to all associated tools, so that’s <code>gcc</code>, <code>g++</code>, <code>gdb</code> etc).
Installing the tools are quite easy, and they just happen with
<code>brew install gcc gdb</code>. However, <code>gcc</code> and <code>g++</code> are already taken by <code>clang</code>,
so you’ll have to export them in your <code>.zshrc</code> again</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;" tabindex="0"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>alias gcc<span style="color:#f92672">=</span>/usr/local/bin/gcc-10
</span></span><span style="display:flex;"><span>alias g++<span style="color:#f92672">=</span>/usr/local/bin/g++-10
</span></span></code></pre></div><p>GDB, however, is <em>very</em> tricky to get working right; MacOS due to SIP and
Gatekeeper, does not allow running processes to latch on to other processes.
For GDB to work, it would need to be signed. For this, you’ll have to sign
it yourself with a certificate, and add that certificate to the trusted
keychain in your system. I <em>still</em> could not get it to work after this (more
info <a href="https://dev.to/jasonelwood/setup-gdb-on-macos-in-2020-489k">here</a>), and
just using <code>sudo</code> was a hack that I used while I tried to get GDB to work.
LLDB, however, is much better integrated with debugging, and I eventually
shifted over to using LLDB rather than GDB (aided by <a href="https://lldb.llvm.org/use/map.html">this</a>
resource).</p>
<p>The GCC/G++ aliasing is highly recommended, and you could leave out GDB (which
is what I’ve done in my current setup)</p>
<h2 id="other-stuff">Other stuff</h2>
<p><code>make</code> seems to work without a hitch so far, which is a good thing. <code>cscope</code>
also had to be installed with brew, and cscope also works well now. I’ll need
to finish setting up my vim environment for C autocompletion and play around
more with CTags and cscope (maybe write about it in the next post :)) For
now, this has unfortunately turned into more of a rant than a how-to, but I
still hoped it help some of you avoid these traps and pitfalls.</p>
<hr/>
<p>*: GCC gives the output as 1, while clang gives it as 0</p>
</section>
<footer class="mt-12 flex flex-wrap">
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/programming">Programming</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href="https://aniruddhadeb.com/tags/c">C</a>
</footer>
<nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
<a class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href="https://aniruddhadeb.com/articles/2021/function-transforms/"><span class="mr-1.5">←</span><span>Function transforms (providing a broader picture of Laplace Transforms)</span></a>
<a class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]" href="https://aniruddhadeb.com/articles/2021/understanding-jacobians/"><span>Understanding Jacobians</span><span class="ml-1.5">→</span></a>
</nav>
<div class="mt-24" id="disqus_thread"></div>
<script>
    const disqusShortname = 'aniruddha-deb';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
</article>
</main>
<footer class="opaco mx-auto flex h-[4.5rem] max-w-4xl items-center px-8 text-[0.9em] opacity-60">
<div class="mr-auto">
    © 2023
    <a class="link" href="https://aniruddhadeb.com">Aniruddha Deb</a>
</div>
<a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank">Built with Hugo️️</a>️
  <a class="link" href="https://github.com/Aniruddha-Deb/hugo-paper" rel="noopener" target="_blank">✎ Paper</a>
</footer>
</body>
</html>
